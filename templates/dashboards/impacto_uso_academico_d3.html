<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Impacto y Uso Acad칠mico (Google Charts)</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de Google Charts -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        /* Estilos generales (manteniendo el tema oscuro) */
        body { background-color: #1a1a2e; color: #e4e4e4; font-family: 'Inter', sans-serif; }
        .chart-container { 
            background-color: #24243e; 
            border-radius: 12px; 
            padding: 25px; 
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.6); 
            margin-bottom: 30px; 
            transition: transform 0.3s ease;
        }
        .chart-container:hover {
            transform: translateY(-5px);
        }
        h1 { color: #ffcc00; text-align: center; font-size: 2.5rem; margin-bottom: 20px; }
        h2 { color: #fff; border-bottom: 2px solid #4a4e69; padding-bottom: 10px; }
        .filter-control { 
            background-color: #000; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 30px; 
            display: flex; 
            gap: 20px; 
            flex-wrap: wrap; 
            justify-content: center; 
            align-items: center; 
        }
        .filter-control label, .filter-control select { color: #ffd700; font-weight: 600; }
        .filter-control input, .filter-control select { 
            background-color: #333; 
            color: #fff; 
            border: 1px solid #555; 
            padding: 8px 12px; 
            border-radius: 6px; 
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .filter-control input:focus, .filter-control select:focus {
            outline: none;
            border-color: #ffd700;
        }
        
        /* Asegurarse de que Google Charts use el color de fondo oscuro */
        .google-chart-text {
            fill: #e4e4e4 !important;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <h1 class="text-3xl font-bold">游꿉 Dashboard de Impacto y Uso Acad칠mico</h1>

    <!-- Controles de Filtro (No tienen efecto en los datos de demostraci칩n, pero se mantienen para la estructura) -->
    <div class="filter-control">
        <label for="filter-inicio">Fecha Inicio:</label>
        <input type="date" id="filter-inicio" onchange="drawAllCharts()">
        
        <label for="filter-fin">Fecha Fin:</label>
        <input type="date" id="filter-fin" onchange="drawAllCharts()">
        
        <label for="filter-material">Tipo Material:</label>
        <select id="filter-material" onchange="drawAllCharts()">
            <option value="">Todos</option>
            <option value="Bibliogr치fico">Bibliogr치fico</option>
            <option value="Audiovisual">Audiovisual</option>
        </select>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Gr치fico 1: Sankey Diagram (Sustituye a Force Graph) -->
        <div class="chart-container lg:col-span-2">
            <h2 class="text-xl font-semibold mb-4 text-white">Flujo de Pr칠stamos: Estudiantes y Materiales (Diagrama de Sankey)</h2>
            <div id="sankey_relations" class="h-96 w-full flex items-center justify-center"></div>
        </div>

        <!-- Gr치fico 2: Histograma -->
        <div class="chart-container lg:col-span-1">
            <h2 class="text-xl font-semibold mb-4 text-white">Histograma de Duraci칩n de Pr칠stamos (D칤as)</h2>
            <div id="histogram_duracion" class="h-96 w-full flex items-center justify-center"></div>
        </div>

        <!-- Gr치fico 3: Pie Chart -->
        <div class="chart-container lg:col-span-3">
            <h2 class="text-xl font-semibold mb-4 text-white">Distribuci칩n de Devoluciones por Estado del Ejemplar</h2>
            <div id="pie_chart_estado" class="h-96 w-full flex items-center justify-center"></div>
        </div>
    </div>

    <script type="text/javascript">
        // 1. Cargar el paquete de Google Charts
        google.charts.load('current', {'packages':['corechart', 'sankey']});
        google.charts.setOnLoadCallback(drawAllCharts);

        // --- DATOS DE DEMOSTRACI칍N (Para reemplazar la API) ---
        
        // Datos para Sankey Diagram (Flujo/Relaciones: Estudiante -> Material -> Frecuencia)
        const dummyRelacionData = [
            ['Estudiante', 'Material', 'Frecuencia'],
            ['Estudiante 1', 'Libro A (Ficci칩n)', 3],
            ['Estudiante 2', 'Libro B (Ciencia)', 1],
            ['Estudiante 3', 'Video C (Doc.)', 5],
            ['Estudiante 1', 'Video C (Doc.)', 2],
            ['Estudiante 4', 'Libro A (Ficci칩n)', 1],
            ['Estudiante 2', 'Libro C (Historia)', 2],
            ['Estudiante 5', 'Revista D (Arte)', 4],
            ['Estudiante 3', 'Revista D (Arte)', 1],
        ];

        // Datos para Histograma (Duraci칩n de Pr칠stamos en D칤as)
        // La columna 1 es el valor (d칤as) y la columna 2 (opcional) es la serie/categor칤a
        const dummyDuracionData = [
            ['Duraci칩n (D칤as)', 'Tipo Material'],
            [5, 'Bibliogr치fico'], [12, 'Bibliogr치fico'], [15, 'Audiovisual'], [2, 'Bibliogr치fico'], [8, 'Bibliogr치fico'],
            [28, 'Audiovisual'], [18, 'Bibliogr치fico'], [3, 'Audiovisual'], [10, 'Bibliogr치fico'], [14, 'Bibliogr치fico'],
            [1, 'Audiovisual'], [25, 'Bibliogr치fico'], [7, 'Bibliogr치fico'], [19, 'Audiovisual'], [6, 'Audiovisual'],
            [16, 'Audiovisual'], [9, 'Bibliogr치fico'], [22, 'Audiovisual'], [20, 'Bibliogr치fico'], [11, 'Audiovisual'],
        ];

        // Datos para Pie Chart (Distribuci칩n de Devoluciones por Estado)
        const dummyEstadoData = [
            ['Estado del Ejemplar', 'Total Devoluciones'],
            ['Excelente', 750],
            ['Buen Estado', 200],
            ['Da침ado Leve', 45],
            ['Perdido', 5]
        ];

        // --- FUNCIONES DE DIBUJO ---

        function drawAllCharts() {
            // Nota: Los filtros no aplican l칩gica de filtrado real a los datos fijos, solo fuerzan el redibujado.
            console.log("Redibujando gr치ficos con datos de demostraci칩n...");
            drawSankeyChart('sankey_relations', dummyRelacionData);
            drawHistogramChart('histogram_duracion', dummyDuracionData);
            drawPieChart('pie_chart_estado', dummyEstadoData);
        }

        function drawSankeyChart(elementId, data) {
            const dataTable = google.visualization.arrayToDataTable(data);

            const options = {
                width: '100%',
                height: 400,
                sankey: {
                    node: {
                        colors: ['#3e9dff', '#ffcc00', '#ff4d4d', '#4caf50', '#a05195'], // Colores para los nodos
                        label: {
                            fontName: 'Inter',
                            fontSize: 14,
                            color: '#e4e4e4',
                            bold: true
                        }
                    },
                    link: {
                        colorMode: 'gradient' // Muestra el grosor del enlace
                    }
                },
                backgroundColor: '#24243e' // Fondo del contenedor de Google Charts
            };

            const chart = new google.visualization.Sankey(document.getElementById(elementId));
            chart.draw(dataTable, options);
        }

        function drawHistogramChart(elementId, data) {
            const dataTable = google.visualization.arrayToDataTable(data);

            const options = {
                title: 'Duraci칩n de Pr칠stamos por Material',
                legend: { position: 'top', textStyle: { color: '#e4e4e4' } },
                histogram: { bucketSize: 5 },
                vAxis: { 
                    title: 'Frecuencia', 
                    titleTextStyle: { color: '#ffd700' },
                    textStyle: { color: '#e4e4e4' },
                    gridlines: { color: '#4a4e69' }
                },
                hAxis: { 
                    title: 'Duraci칩n (D칤as)', 
                    titleTextStyle: { color: '#ffd700' },
                    textStyle: { color: '#e4e4e4' }
                },
                series: {
                    0: { color: '#3e9dff' }, // Bibliogr치fico
                    1: { color: '#ffcc00' }  // Audiovisual
                },
                backgroundColor: '#24243e',
                titleTextStyle: { color: '#e4e4e4', fontSize: 16 },
                chartArea: { width: '80%', height: '70%' }
            };

            const chart = new google.visualization.Histogram(document.getElementById(elementId));
            chart.draw(dataTable, options);
        }

        function drawPieChart(elementId, data) {
            const dataTable = google.visualization.arrayToDataTable(data);

            const options = {
                title: 'Distribuci칩n por Estado del Ejemplar',
                pieHole: 0.4, // Gr치fico de Donut
                legend: { position: 'right', textStyle: { color: '#e4e4e4' } },
                colors: ['#4caf50', '#ffd700', '#ffcc00', '#ff4d4d'], // Excelente, Buen Estado, Da침ado Leve, Perdido
                backgroundColor: '#24243e',
                titleTextStyle: { color: '#e4e4e4', fontSize: 16 },
                pieSliceTextStyle: { color: '#1a1a2e', fontSize: 13 },
                tooltip: { textStyle: { color: '#000' } } 
            };

            const chart = new google.visualization.PieChart(document.getElementById(elementId));
            chart.draw(dataTable, options);
        }
    </script>
</body>
</html>